# 学习笔记

## 20.1 背景

* Node的最初构想是为了使异步编程变得简单方便

## 20.2 node命令

* 与console绑定一样，process绑定在Node中全局可用。它提供了各种方法来检查和操作当前程序：
  * exit方法可以结束进程并给出一个退出状态码（该代码告诉启动Node的程序是成功完成还是遇到错误）
  * 要查找给予脚本的命令行参数，可以读取process.argv，它是一个字符串数组（因为包含node命令名称和脚本名称，实际参数从索引2开始）
* 所有JavaScript标准绑定（例如：Array、Math、JSON）也存在于Node的环境中。与浏览器相关的功能（例如：document、prompt）则不包括在内

## 20.3 模块

* 如果要访问node的内置功能，必须利用模块系统
* 基于require函数的CommandJS模块系统内置于Node中，用于将内置模块、下载包中的任何内容加载到自己程序的文件中
  * 调用require时，Node必须将给定的字符串解析为可以加载的实际文件，可以省略.js扩展名
  * 当一个看起来不像相对或绝对路径的字符串被赋予require时，它被认为是指内置模块或安装在node_modules目录中的模块

## 20.4 使用NPM安装

* 运行npm install后，NPM将创建一个名为node_modules的目录
* 默认情况下，NPM在当前目录下，而不是在某个中心位置安装软件包
* npm init可以为每个项目创建package.json文件，它包含有关项目的一些信息（例如其名称和版本，并列出其依赖项）
* 在没有命名要安装的软件包的情况下运行npm install时，NPM将安装package.json中列出的依赖。当你安装尚未列为依赖项的特定包时，NPM会将其添加到package.json
* NPM要求其软件包遵循语义版本模式。语义版本由三个数字组成并以句点分隔。每次添加新功能时，版本号中间的数字都必须递增。每次兼容性被破坏时，使用该包的现有代码可能无法与包的新版本一起使用，版本号的第一个数字必须递增
* 版本号前面的脱字符（^）表示与给定数字兼容的任何版本可能会安装
* npm命令还用于发布新包或新版本的包：在package.json文件的目录中运行npm publish，将把一个包连同一个列出包的名称和版本的JSON文件发布到注册目录
* 另一个可以从NPM注册表安装的程序是yarn

## 20.5 文件系统模块

* fs模块代表文件系统，它导出用于处理文件和目录的函数
* readFile函数读取文件：第二个参数表示将文件解码为该参数指定的字符编码。如果没有传递编码，Node将假定你对二进制数据感兴趣并且将为你提供Buffer对象（类似数组的对象，它包含表示文件中字节的数字）而不是字符串
* writeFile用于将文件写入磁盘：当给它一个要写的字符串而不是一个Buffer对象时，会假设使用默认字符编码（UTF-8）
* readdir将返回目录中的文件作为字符串数组
* stat将检索有关文件的信息
* rename将重命名文件
* unlink将删除一个文件
* 大多数函数都将回调函数作为最后一个参数：第一个参数代表错误结果，第二参数代表成功结果
* fs中的许多函数有同步变体，它以原函数的名称开头，同时将Sync添加到名字末尾。执行此类同步操作时，程序将完全停止

## 20.6 HTTP模块

* http模块，提供运行HTTP服务器和发出HTTP请求的功能
* http模块的createServer函数创建一个HTTP服务器
* request和response绑定，代表出入和传出数据的对象。
  * request包含有关请求的信息，例如url属性包含请求的URL
  * response:
    * response.writeHead，写出响应标头，需要给它提供状态码和包含标头值的对象
    * response.write，发送实际响应主体
    * response.end，表示响应结束
* 服务器对象（例如名叫server）的listen的调用，导致服务器开始等待端口上的连接。监听一直等待，脚本监听事件时，Node到达脚本末尾时将不会自动退出
* http模块的request函数，充当HTTP客户端。第一个参数配置请求，第二个参数是响应进入时应该调用的函数
  * 与在服务器中的response对象一样，http.request调用返回的对象允许使用write方法将数据流式传输到请求中
* https模块中有一个类似的request函数，可用于向https:URL发出请求

## 20.7 流

* 两个可写流实例：
  * 服务器可以写入的response对象
  * 请求返回的request对象
* 可写流是Node中广泛使用的概念，这样的对象有一个write方法，可以传递一个字符串或一个buffer对象来将一些东西写入流。它们的end方法关闭流，这两种方法可以附加参数给出回调函数
* 可以使用fs模块中的createWriteStream函数创建指向文件的可写流。然后可以在结果对象上使用write方法一次一个地写入文件，而不是像writeFile一样一次写入全部
* 可读流：
  * 传递给HTTP服务器回调函数的request绑定
  * 传递给HTTP客户端回调函数的response绑定
  * 从流中读取是使用事件处理程序而不是方法完成的
  * 可读流具有“data”和“end”事件
* 在Node中发出事件的对象有一个名为on的方法，类似于浏览器中的addEventListener方法。给它传入一个事件名称和函数，它会注册在给定事件发生时要调用的函数

## 20.8 文件服务器

* 
